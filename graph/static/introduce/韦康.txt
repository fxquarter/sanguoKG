建安十二年(公元207年)曹操署其代父凉州州牧。建安十七年(公元212年) 马超退走凉州后复集羌胡之众攻陇上诸县，群县响应，唯凉州州治冀城坚守。
张鲁
遣将
杨昂
助马超。建安十八年(公元213年) 围城期间曾派凉州别驾
阎温
突围救援，但被马超军所擒。自正月坚守至八月援军未至无望后因不想百姓受饥饿之苦而不理杨阜等人所劝出降。但事后马超违约指使杨昂把他杀害。故州人对素有仁德的他在得知死讯后莫不凄然愤慨。